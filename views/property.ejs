<%- include('header') %>

<%- include("nav") %>

-->
            <div class="wrapper">
                <!-- Start content -->
                <div class="content">
                    <div class="container-fluid">
                        <div class="page-title-box">
                            <div class="row align-items-center">
                                <div class="col-sm-6">
                                    <h4 class="page-title"><%= prop.property_name %></h4>
                                </div>
                                <div class="col-sm-6">
                                    <ol class="breadcrumb float-right">
                                        <li class="breadcrumb-item"><a href="javascript:void(0);">Home</a></li>
                                        <li class="breadcrumb-item"><a href="javascript:void(0);">Dashboard</a></li>
                                        <li class="breadcrumb-item active"><%= prop.property_name %></li>
                                    </ol>
                                </div>
                            <div class="col-sm-9 mx-auto pt-5 mb-3">
                            <div class="card container-fluid mt-5">
                            <div class="card-body py-6">
                                <div class="row align-items-center">
                                    <div class="col-md-7">
                                        <div class="d-md-flex align-items-center">
                                            <div class="text-center text-sm-left mr -3">
                                            <center>
                                                <div class="avatar avatar-image" style="border-radius: 50%;width: 160px; height:160px; background: url('<%= prop.img_url %>'); background-position: center; background-size: cover;">
                                                </div>
                                            </center>
                                            </div>
                                            <div class="text-center text-sm-left m-v-15 p-l-30 pl-3">
                                                <h4 class="m-b-5"><%= prop.property_name %></h4>
                                                <p class="text-opacity font-size-14 text-muted"><i class="mdi mdi-map-marker-radius"></i> <%= prop.location %></p>
                                             <p class="text-dark m-b-20"><%= prop.property_description %></p>	
                                            <a href="#" class="btn btn-primary float-right ml-3" data-toggle="modal" data-target=".edit-modal">Edit</a> <a href="/flats/<%= prop.id %>" class="btn btn-warning float-right">View Flats</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5 mx-auto">
                                        <div class="row">
                                            <div class="d-md-block d-none border-left col-1"></div>
                                            <div class="col mx-auto">
                                                <label>Manager Details </label>
                                                <ul class="list-unstyled text-center m-t-10">
                                                    <li class="row">
                                                        <p class="col-sm-4 col-4 font-weight-semibold text-dark m-b-5">
                                                            <i class="m-r-10 text-primary anticon anticon-mail"></i>
                                                            <span>Email: </span> 
                                                        </p>
                                                        <p class="col font-weight-semibold"> <%= prop.manager.email %></p>
                                                    </li>
                                                    <li class="row">
                                                        <p class="col-sm-4 col-4 font-weight-semibold text-dark m-b-5">
                                                            <i class="m-r-10 text-primary anticon anticon-phone"></i>
                                                            <span>Phone: </span> 
                                                        </p>
                                                        <p class="col font-weight-semibold"> <%= prop.manager.phone %></p>
                                                    </li>
                                                    <li class="row">
                                                        <p class="col-sm-4 col-4 font-weight-semibold text-dark m-b-5">
                                                            <i class="m-r-10 text-primary anticon anticon-compass"></i>
                                                            <span>Name: </span> 
                                                        </p>
                                                        <p class="col font-weight-semibold"> <%= prop.manager.firstName %>  <%= prop.manager.lastName %></p>
                                                    </li>
                                                </ul>
                                                <div class="d-flex font-size-22 m-t-15">
                                                    <a href="" class="text-gray p-r-20">
                                                        <i class="anticon anticon-facebook"></i>
                                                    </a>        
                                                    <a href="" class="text-gray p-r-20">    
                                                        <i class="anticon anticon-twitter"></i>
                                                    </a>
                                                    <a href="" class="text-gray p-r-20">
                                                        <i class="anticon anticon-behance"></i>
                                                    </a> 
                                                    <a href="" class="text-gray p-r-20">   
                                                        <i class="anticon anticon-dribbble"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                            </div>
                            </div> <!-- end row -->
                        </div>
                        <!-- end page-title -->

                        
                    </div>
                    <!-- container-fluid -->

                </div>
                <!-- content -->
                   
                                                 <div class="modal fade edit-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <form class="modal-content" onsubmit="edit(event)">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title mt-0">Edit Property</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="card-body">
        
                                        <p class="sub-title">Complete the form to edit a property</p>
                                                                
                                              
                                        <div class="form-group row">                  
                                      <label for="desc" class="col-sm-12 pb-1 col-form-label">Property Name</label>
                                            <div class="col-sm-12">
                                                <input class="form-control" type="text" id="edit_title" value="<%= prop.property_name %>" required>
                                            </div>
                                        </div>
                                           <div class="form-group row">                  
                                      <label for="desc" class="col-sm-12 pb-1 col-form-label">Property Location</label>
                                            <div class="col-sm-12">
                                                <input class="form-control" type="text" id="edit_loc" value="<%= prop.location %>"  required>
                                            </div>
                                        </div>
                                                           <div class="form-group row">
                                        <div class="col-sm-12" id="edit_err">
                                                            </div>
                                                                </div>
                                                            </div>
                                                        
                                                        <div class="modal-footer">
                                                        <button type="submit" class="btn btn-primary" id="edit_btn">Submit</button>
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                    </div>
                                                        </div>
                                                            </form>
													<!-- /.modal-content -->
                                                    </div><!-- /.modal-dialog -->
                                                </div><!-- /.modal -->
            <script>
                  const edit = (event) => {event.preventDefault()
    document.getElementById("edit_err").innerHTML = ""
  	document.getElementById("edit_btn").disabled = true
    document.getElementById("edit_btn").innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading`

         axios.post('/edit-property',
          { 
              id: '<%= prop.id %>',
              name: document.getElementById("edit_title").value,
              loc: document.getElementById("edit_loc").value,
          }
        ).then(function (data) {


 if(data.data.message){
	  document.getElementById("edit_err").innerHTML = `<div class="alert alert-success alert-dismissible fade show" role="alert">
                                                <strong>Great!</strong> ${data.data.message}`
      
  	document.getElementById("edit_btn").disabled = false
    document.getElementById("edit_btn").innerHTML = "Edit"
	 location.reload()
 }
 else if(data.data.error){
	document.getElementById("edit_err").innerHTML = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                <strong>Oh snap!</strong> ${data.data.error}`
          
  	document.getElementById("edit_btn").disabled = false
    document.getElementById("edit_btn").innerHTML = "Edit"
 }
          
        })
        .catch(err => {
        if(err.response){
          if(err.response.status == 401){
	document.getElementById("edit_err").innerHTML = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                <strong>Oh snap!</strong> ${err.response.data.error}`
          
  	document.getElementById("edit_btn").disabled = false
    document.getElementById("edit_btn").innerHTML = "Edit"
location.reload()
          }
          
        }
        else if(err){
    document.getElementById("edit_err").innerHTML = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                <strong>Oh snap!</strong> There Was an error processing your request please retry`
    
          
  	document.getElementById("edit_btn").disabled = false
    document.getElementById("edit_btn").innerHTML = "Edit"
          
        }
      });

}
            </script>
<%- include("footer") %>

